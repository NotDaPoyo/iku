{% extends 'base.html' %}
{% block content %}
{% load static %}

<div id="container" class="container">
    <div class="d-flex flex-row align-items-center">
        <img height="50vh" class="p-2" src="{% static 'iku-stripes.png' %}">
        <h1>Iku Music Player</h1>
        <div id="profile">
            <h4>
                {% if user.is_authenticated %}
                <p>Welcome, {{ user }}!</p>
                {% else %}
                <a href="login">Login here!</a>
                {% endif %}
            </h4>
        </div>
    </div>
    <div class="d-flex flex-row h-fill w-fill">
    <div class="p-2 py-1 w-25 h-100 bg-dark text-white">
        <h1 class="underline">Play.list</h1>
        <div class="border border-light h-75 p-2">
            <h2>Music</h2>
            <p>Lenght: {{song_lenght}} seconds.</p>
            <h4>Now playing: {{ selected_song.name }}</h4>
            <div>
                {% for song in playlist %}
                <div class="d-inline">
                    <h3 class="d-inline">- {{ song.name }}     </h3><h6 >< {{song.author}} ></h6>
                </div>
                {% endfor %}
            </div>
        </div>
        <div id="player" class="border border-light w-100 d-flex">
            
            <audio>
              Your browser does not support the audio element.
            </audio>
            <audio id="track">
                <source src="{{song_location.url}}" type="audio/mpeg">
            </audio>
            
            <div id="player-container">
                <div class="d-inline-block">
                    <input type="checkbox" id="checkbox" class="text-white check">Loop?</input>
                    <div class="d-block h-auto">
                        <input type="range" class="slider" name="audioProgress" id="audioProgress" min="0" value="0" max="{{song_lenght}}" step=".1">Time</input>
                        <input type="range" class="slider" name="volume" id="volume" min="0" value="0" max="100" step="1">Volume</input>
                    </div>
                </div>
                <div id="play-pause" class="play w-100"></div>
            </div>
        </div>
    </div>
    <div class="w-100">
        <div class="p-3 py-1 w-100 h-75 background-green">
            <h1 class="underline">Song.List</h1>
            
            <div>
                {% for song in songs %}
                    <div class="bg-success3">
                        <a id="audio-link" href="../home/{{ song.id }}">- <h3 class="d-inline">{{ song.name }}</h3></a><h6 class="d-inline">     < {{song.author}} ></h6>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="w-100 h-25 p-3">
            <h1>Made with love by Poyo!</h1>
            <h3>With the help of: <a href="https://thesomething.uk/">Jesus</a>.</h3>
        </div>
    </div>
    
</div>


    <script>
        var track = document.getElementById('track');
        var controlBtn = document.getElementById('play-pause');
        var audioProgress = document.getElementById('audioProgress');
        var checkbox = document.getElementById('checkbox');

        function playPause() {
            if (track.paused) {
                track.play();
                controlBtn.className = "pause";
            } else { 
                track.pause();
                controlBtn.className = "play";
            }
        }

        function updateTrackTime() {
            if (audioProgress.clicked) {
                audioProgress.value = track.currentTime;
            } else {
                track.currentTime = audioProgress.value;
            }
            audioProgress.value = track.currentTime;
        }

        controlBtn.addEventListener("click", playPause);
        track.addEventListener("ended", function() {
            controlBtn.className = "play";
        });
        audioProgress.addEventListener("input", updateTrackTime);


        var volumeInput = document.getElementById('volume');
        volumeInput.addEventListener('input', function() {
            track.volume = volumeInput.value/100;

        });

    function getTimeCodeFromNum(num) {
        let seconds = parseInt(num);
        let minutes = parseInt(seconds / 60);
        seconds -= minutes * 60;
        const hours = parseInt(minutes / 60);
        minutes -= hours * 60;
        if (hours === 0) return `${minutes}:${String(seconds % 60).padStart(2, 0)}`;
        return `${String(hours).padStart(2, 0)}:${minutes}:${String(
          seconds % 60
            ).padStart(2, 0)}`;
    }
    </script>

{% endblock content %}